{% extends template('page-layout-checkout', 'CheckoutPage') %}

{% define data = {
    clientId: _view.amazonpayConfig.clientId,
    sellerId: _view.amazonpayConfig.sellerId,
    orderReferenceUrl: path('amazonpay_set_order_reference'),
    shipmentMethodsUrl: path('amazonpay_get_shipment_methods'),
    updateShipmentMethodUrl: path('amazonpay_update_shipment_method'),
    shipmentMethodUrl: path(''),
    displayMode: _view.addressBookMode | default(''),
    orderReferenceId: _view.orderReferenceId | default(''),
    addressScope: 'profile payments:widget payments:shipping_address payments:billing_address',
    walletScope: 'profile postal_code payments:widget payments:shipping_address',
} %}

{% set steps = [{
    title: 'checkout.amazonpay' | trans,
    route: null,
    isActive: true,
    isEnabled: true
}] %}

{% block breadcrumbs %}
    {% include view('cart-checkout-breadcrumb', 'CheckoutWidget') with {
        data: {
            addCartBreadcrumb: true,
            isCartPage: false,
            checkoutBreadcrumbs: steps
        }
    } only %}
{% endblock %}

{% block content %}
    {% include molecule('script-loader') with {
        attributes: {
            src: _view.amazonpayConfig.isSandbox ? _view.amazonpayConfig.widgetScriptPathSandbox : _view.amazonpayConfig.widgetPathScript
        }
    } only %}
    {% include molecule('script-loader') with {
        attributes: {
            src: 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'
        }
    } only %}
    <div class="box">
        <div class="grid">
            <div class="col col--sm-12 spacing-bottom--big">
                {% if _view.quoteTransfer.payment and _view.quoteTransfer.payment.paymentMethod %}
                    <h5>{{ 'checkout.step.summary.payment' | trans }}</h5>
                    <ul class="list">
                        <li class="list__item">
                            <span>{{ 'checkout.step.summary.with_method' | trans }}</span>
                            {{ _view.quoteTransfer.payment.paymentMethod }}
                        </li>
                    </ul>
                {% endif %}

                {% if _view.cartItems is defined %}
                    <ul class="list">
                        {% for item in _view.cartItems %}
                            <li class="list__item">
                                {{ item.name }}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>

            <div class="col col--sm-12">
                {% include molecule('payment-step', 'AmazonPay') with {
                    attributes: {
                        sellerId: data.sellerId,
                        orderReferenceUrl: data.orderReferenceUrl,
                        shipmentMethodsUrl: data.shipmentMethodsUrl,
                        updateShipmentMethodUrl: data.updateShipmentMethodUrl,
                        shipmentMethodUrl: '',
                        locale: app.locale,
                        addressScope: data.addressScope,
                        walletScope: data.walletScope,
                        displayMode: data.displayMode,
                        orderReferenceId: data.orderReferenceId,
                        shipmentMethodsHolder: '.shipment-methods__holder',
                        nameShipmentMethod: 'amazonpayShipmentMethod',
                        summaryInfoHolder: ''
                    }
                } only %}

                {% include atom('shipment-methods', 'AmazonPay') only %}
            </div>

            <div class="col col--sm-12">
                <div id="amazonpaySummeryInformation">
                    {% include molecule('shipment-method', 'AmazonPay') with {
                        data: {
                            quoteTransfer: _view.quoteTransfer
                        }
                    } only %}
                </div>
            </div>

            <div class="col col--sm-12">
                <a href="{{ path('amazonpay_confirm_purchase') }}"
                   id="amazonpayPlaceOrderLink"
                   class="button button--success"
                   data-component="disable-on-click">
                    {{ 'checkout.step.place.order' | trans }}
                </a>
            </div>
        </div>
    </div>
{% endblock %}
