{% extends model('component') %}

{% define config = {
    name: 'wallet',
    tag: 'wallet'
} %}

{% define attributes = {
    clientId: required,
    sellerId: required,
    orderReferenceUrl: required,
    shipmentMethodsUrl: required,
    locale: required,
    addressBookMode: null,
    orderReferenceId: null
} %}

{% block body %}
    {#<div id="{{ config.jsName }}__item"></div>#}

    {% for message in app.session.flashbag.get('flash.messages.error') %}
        <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}

    <div id="amazonpayWalletWidgetContainer"> </div>

    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>
        var amazonpayConfig = {
            clientId: "{{ attributes.clientId }}",
            sellerId: "{{ attributes.sellerId }}",
            setOrderReferenceUrl: "{{ path('amazonpay_set_order_reference') }}",
            getShipmentMethodsUrl: "{{ path('amazonpay_get_shipment_methods') }}",
            locale: '{{ app.locale }}'
            {% if addressBookMode is defined %}
            , addressBookMode: '{{ addressBookMode }}'
            {% endif %}
            {% if orderReferenceId is defined %}
            , amazonOrderReferenceId: '{{ orderReferenceId }}'
            {% endif %}
        };
    </script>
    <style>
        #amazonpayWalletWidgetContainer {
            min-width: 300px;
            width: 100%;
            max-width: 900px;
            min-height: 228px;
            height: 240px;
            max-height: 400px;
        }
    </style>
    <script>

        window.onAmazonLoginReady = function() {
            amazon.Login.setClientId(amazonpayConfig.sellerId);
        };
        window.onAmazonPaymentsReady = function() {
            new OffAmazonPayments.Widgets.Wallet({
                sellerId: amazonpayConfig.sellerId,
                scope: 'profile postal_code payments:widget payments:shipping_address',
                amazonOrderReferenceId: amazonpayConfig.amazonOrderReferenceId,
                onPaymentSelect: function(orderReference) {
                    // Replace this code with the action that you want to perform
                    // after the payment method is selected.

                    // Ideally this would enable the next action for the buyer
                    // including either a "Continue" or "Place Order" button.
                },
                design: {
                    designMode: 'responsive'
                },
                onError: function(error) {
                }
            }).bind("amazonpayWalletWidgetContainer");
        };

    </script>
{% endblock %}
